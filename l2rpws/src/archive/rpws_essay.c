#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include "rpws_label.h"

static char *Version = { "V1.3" };

struct TEXT
{
  int flag;
  char *text;
};

struct TEXT text_item[] = {
  0, "***** essay ********** essay ********** essay ********** essay ******",
  0, "",
  0, "RPWS ARCHIVE for WBR/WFR",
  0, "                                                  Updated 12 Apr 2005",
  0, "                                                                     ",
  0, "      This is the archive program for CASSINI/RPWS high rate data    ",
  0, "    products.  This covers all electric waveform data collected by   ",
  0, "    the insturment that is not analyzed onboard the spacecraft.      ",
  0, "    Specifically this includes Wideband(WBR) and Waveform(WFR) data. ",
  0, "    L/P data is not included as it is not collected by the electric  ",
  0, "    antennas (L/P measures current).  HFR data is not included as it ",
  0, "    is not raw waveform data (i.e. it is analyzed by HFR and         ",
  0, "    delivered to the ground in a reduced format.                     ",
  0, "                                                                     ",
  0, "      The high rate archive software has several assists to aid in   ",
  0, "    the production of CD/DVD media.  First, the size of the resulting",
  0, "    files may be limited through the use of a comman line switch.    ",
  0, "    This is intended to provide a means of producing CD sized        ",
  0, "    collections of data that are, effectively, ready to transfer     ",
  0, "    directly to media.  Second, the datasets are segregated to       ",
  0, "    separate directories as specified in the SIS (Software Interface ",
  0, "    Specification).  Third, a file is produced that contains a list  ",
  0, "    of files along with their start and stop times that may be used  ",
  0, "    to generate additional files that may be required on the media   ",
  0, "    (specifically,  the quick-look images).  And finally,            ",
  0, "    a postscript label file that may be used to produce labels for   ",
  0, "    the resulting CD or DVD media.                                   ",
  0, "                                                                     ",
  0, "      This document will try to provide enough information to use    ",
  0, "    the program and the resulting data.  This is also the place      ",
  0, "    where you will find detailed documentation on the procedures     ",
  0, "    and formats used by the archive effort.                          ",
  0, "                                                                     ",
  0, "                                                                     ",
  0, "RPWS ARCHIVE for Housekeeping data                                   ",
  0, "                                                                     ",
  0, "      This is the archive program for CASSINI/RPWS housekeeping data.",
  0, "    This archive is in a format similar to the WBR/WFR data.  It     ",
  0, "    makes use of the same record header (although many of the fields ",
  0, "    are not use and are set to zero).                                ",
  0, "      The housekeeping archive is extracted from the R_FILE data.    ",
  0, "    since this is a different dataset than that used for WBR/WFR     ",
  0, "    data, the housekeeping archive is run as a separate program.     ",
  0, "    There are 2 output streams from the housekeeping archive program,",
  0, "    the raw housekeeping data (consisting of header and the 192 octet",
  0, "    housekeeping buffer from the instrument) and the extracted       ",
  0, "    dust housekeeping micropackets.                                  ",
  0, "      Housekeeping micro-packets are typically 16 bytes long and     ",
  0, "    appear in the last 128 bytes of the housekeeping record.  As     ",
  0, "    each new packet is received by the housekeeping process in LRP   ",
  0, "    it is placed at the begining of the micro packet area, older     ",
  0, "    packets are pushed towards the tail end of the housekeeping      ",
  0, "    record.  To extract them, we need to pick each micro packet out  ",
  0, "    and determine if it is a new (i.e. unique) micropackket as there ",
  0, "    is no mechanism to control underflow/overflow in the micropacket ",
  0, "    stream in the housekeeping data. After extraction and comparisons",
  0, "    have been made, the resulting micro packet stream contains no    ",
  0, "    duplicates.  Micro-packet streams that originate from a single   ",
  0, "    source in the instrument (DUST and BFDL packets) will be in time ",
  0, "    order.  Micro-packet streams that are supplied by multiple       ",
  0, "    processeses, however, may arrive slightly out of order (73MRO    ",
  0, "    commands that target more than 1 processor may result in micro-  ",
  0, "    packets that are slightly jumbled (we rarely command the         ",
  0, "    instrument in a manner that would cause this to happen).         ",
  0, "      Labels are produced for all selected data sets with the        ",
  0, "    start/stop times being based on the time of the housekeeping     ",
  0, "    packet stream.  Individual micro-packets are, however, marked    ",
  0, "    with a corrected time-tag using the same method that is used to  ",
  0, "    derive minipacket time tags.  As long as DUST is running, and    ",
  0, "    providing micro-packets, the time-tags will be accurate.         ",
  0, "    Stagnant micro-packets can be labeled with inappropriate times.  ",
  0, "                                                                     ",
  0, "      As mentioned above, the header matches that of the WBR/WFR.    ",
  0, "    Fields that are used are:                                        ",
  0, "                 archive_event_clock      sclk                       ",
  0, "                 archive_event_time       scet                       ",
  0, "                 short                    record_bytes               ",
  0, "                 short                    samples                    ",
  0, "                 short                    data_rti                   ",
  0, "                 char                     status_flag                ",
  0, "                 char                     fsw_ver                    ",
  0, "    All other fields in the header portion of the record are zero    ",
  0, "    filled. The housekeeping archive record is 224 bytes in length   ",
  0, "    while the dust housekeeping is 64 bytes in length.               ",
  0, "                                                                     ",
  0, "      \"samples\" is typically set to 16, reflecting the size of       ",
  0, "    the DUST/BFDL micro packet.  IPC handler memory dumps, however   ",
  0, "    are handled slightly different.  Occasionally we will perform    ",
  0, "    a 20 byte dump on the IPC handler (i.e. two MRO at the same      ",
  0, "    time, covering 2 consecutive 10 byte blocks of memory).  When    ",
  0, "    the 2nd. micro-packet is encountered, it is placed into the      ",
  0, "    IPC packet buffer in the appropriate location without clearing   ",
  0, "    the previous contents of the packet buffer (which should hold    ",
  0, "    the previous 10 byte of memory image).  The \"samples\" field      ",
  0, "    will contain 18 at this point.                                   ",
  0, "                                                                     ",
  0, "      Version 5.0 of the housekeeping archive program set the        ",
  0, "    SUSPECT bit in the STATUS_FLAG field in the header when the      ",
  0, "    CHDO header indicates that there is fill data.  This is the      ",
  0, "    bit used in this field ad of V5.0.                               ",
  0, "                                                                     ",
  0, "      V5.1 of housekeeping adds the\"-force\" flag.  This flag          ",
  0, "    is used to include all housekeeping (even HSK with fill data).   ",
  0, "    Default behavior is to discard any HSK data that contains fill.  ",
  0, "                                                                     ",
  0, "      The houskeeping archive program allow selection of several     ",
  0, "    subsets of data.  Dust housekeeping, WBR/WFR (BFDL) housekeeping,",
  0, "    and IPC housekeeping may be split out as needed  (use the -h     ",
  0, "    flag to get a list of selectable subsets).                       ",
  0, "                                                                     ",
  0, "",
  0, "Files and directories:                                               ",
  0, "      Five directories are used by the archiving program, three hold ",
  0, "    data and associated label files, a fourth contains the browse    ",
  0, "    dataset and associated labels, and the fifth holds some extras.  ",
  0, "    WBR data is placed in DATA/WBRFULL/ with the filename being based",
  0, "    on the time the data was collected, typically in one-hour files. ",
  0, "    WFR data/label files are placed in DATA/WFRFULL/, again the file-",
  0, "    name being based on the time the data was collected, but the     ",
  0, "    WFR will nominally be grouped into 24 hour files (due to the     ",
  0, "    lower bit rate that this portion of the instrument operates      ",
  0, "    at).  The third data directory contains raw data which is grouped",
  0, "    in ammer similar to the WBR, that being 1 hour files.  The fourth",
  0, "    group of files, located in the BROWSE directory, are not produced",
  0, "    by this archive program.  They are produced using the same tools ",
  0, "    used by web browsers.  Finally, the fifth set of files, placed in",
  0, "    EXTRAS/ may consist of a variable number of files (some may not  ",
  0, "    be placed on the final archive volume).                          ",
  0, "    The first contains a list of the files that have                 ",
  0, "    been placed in WFRFULL and WBRFULL directories.  The second      ",
  0, "    contains a list of the STIM records and of the 'noisy' events    ",
  0, "    such as Langmuir Probe sweeps and HFR Sounder events.  The       ",
  0, "    third fle is the postscript labelfile used to print the stick-   ",
  0, "    on label for the CD/DVD.  A final group of files are used to     ",
  0, "    generate and display the browse dataset.  This consists of four  ",
  0, "    HTML files and a shell script that is used to generate a set of  ",
  0, "    PNG (image) files.  This group of files is produced using        ",
  0, "    information gathered during the data copy step of the archiving  ",
  0, "    process.                                                         ",
  0, "                                                                     ",
  0, "      The data files are documented through their respective label   ",
  0, "    files, so the files that appear in EXTRAS will be discussed      ",
  0, "    here (the files in EXTRAS are not part of the PDS dataset,       ",
  0, "    the file list and the CD/DVD label are essentially remnants      ",
  0, "    of the archiving process, and remain on the CD/DVD in the        ",
  0, "    event that archiving activities need to be performed in the      ",
  0, "    future.  The STIM event log may be moved to another location     ",
  0, "    in the future (i.e. ANCIL directory) and documented with a       ",
  0, "    PDS label.  As this serves as the only documentation for now     ",
  0, "    it appears in the EXTRAS directory.                              ",
  0, "                                                                     ",
  0, "  WBR/WFR/RAW Directory names                                        ",
  0, "      In order to limit the number of files that appear in any       ",
  0, "    given directory (primarily to keep the volume strictly ISO9660   ",
  0, "    compliant) the WBR, WFR, and RAW files are spread across         ",
  0, "    several layers of sub-directories.  In general, the sub-directory",
  0, "    naming scheme uses yeay and day-of-year in the sub-directory     ",
  0, "    name (i.e. TyyyyXXX, TyyyydXX, TyyyyddX, Tyyyyddd),              ",
  0, "                                                                     ",
  0, "  WBR/WFR/RAW File names                                             ",
  0, "      WBR and WFR files are named using conventions that are as      ",
  0, "    close as is reasonably possible.  Both have year and day as      ",
  0, "    componants of the filename.  WBR also includes an hour as we     ",
  0, "    break WBR into 1 hour files.  WFR is stored in daily files,      ",
  0, "    eliminating the need for the hour in the filename.  Both data    ",
  0, "    sets include an indication of the frequency band and an          ",
  0, "    indication of the number of samples in the dataset.              ",
  0, "      An occasional DUST waveform is sent down in a WBR mini-packet. ",
  0, "    These waveforms are identified by using a \"D\" in the portion     ",
  0, "    of the name used to indicate data set size (DUST waveforms always",
  0, "    consist of 1K samples).                                          ",
  0, "      WBR occasionally operates in anb HFR downconvert mode.  IN     ",
  0, "    this mode, the digital portion of the WBR operates in the 75Khz  ",
  0, "    bandwidth mode and uses the HFR to downconvert from a higher     ",
  0, "    frequency.  This is indicated by placing this data in a file     ",
  0, "    unique to the specific downconvert frequency (i.e. the filename  ",
  0, "    when operating in 325 Khz downconvert mode would be              ",
  0, "    Tyyyddd_hh_325KHZ1_WBRFR).                                       ",
  0, "      RAW files are similar to the others, but there is only year    ",
  0, "    day and hour in the filename (Tyyyyddd_hh_RAW.PKT).              ",
  0, "                                                                     ",
  0, "  WBR/WFR/RAW File sizes                                             ",
  0, "      WBR and WFR files are broken into files by band and time series",
  0, "    size.  The bands are evident as 25HZ, 2_5KHZ, 10KHZ and 75KHZ    ",
  0, "    strings in the filename.  The time series size is indicated by   ",
  0, "    the number that followes the KHZ.  It is one of the following:   ",
  0, "            D    for 1024 (byte) time series DUST data               ",
  0, "            1    for up to 1024 (byte) time series                   ",
  0, "            2    for 1025 to 2048 (byte) time series                 ",
  0, "            4    for 2049 to 4096 (byte) time series                 ",
  0, "            6    for 4097 to 6144 (byte) time series                 ",
  0, "            8    for 6145 to 8192 (byte) time series                 ",
  0, "            9    for 8193 to 20480 (byte) time series                ",
  0, "      Note, of course, that WBR is only provided with a 5120 byte      ",
  0, "    buffer in the instrument, so taking compression into account     ",
  0, "    we may expect to see \"nnKHZ6\" in the filename but should         ",
  0, "    never encounter \"nnKHZ8\" or \"nnKHZ9\".  WFR, on the other hand    ",
  0, "    should not normally produce \"nnKHZ1\" files (although they will   ",
  0, "    show up due to lost data segments).                              ",
  0, "      RAW files are variable length (they are U files with their     ",
  0, "    names changed to follow WBR/WFR naming conventions).             ",
  0, "                                                                     ",
  0, "  HTML Files                                                         ",
  0, "      There are a group of 4 HTML files that are produced to allow   ",
  0, "    viewing the BROWSE data with a suitable web viewer (i.e. Netscape",
  0, "    or Internet Explorer, for example).  This html code assumes that ",
  0, "    PNG images and thumbnails have been produced from the data that  ",
  0, "                                                                     ",
  0, "  TIME_FILE.TXT                                                      ",
  0, "      This file is a list of the files that were produced by this    ",
  0, "    run of the archiving program.  It is in a format, similar to     ",
  0, "    a PDS label file, that lists filenames, start and stop times     ",
  0, "    (in several formats), record counts, file sizes.  The fields     ",
  0, "    that appear in the file may change in the future (i.e.           ",
  0, "    additional fields may appear).                                   ",
  0, "                                                                     ",
  0, "  STIM.TXT and STIM.TAB                                              ",
  0, "      This file contains a list of the triggers processed by the     ",
  0, "    instrument as well as any noisy events (L/P Sweep, HFR Sounder). ",
  0, "    The file is plain text, and the format is explained at the       ",
  0, "    begining of the file.  Basically, the first colums contain       ",
  0, "    time and version information (Spacecraft Clock in 2 formats,     ",
  0, "    Spacecraft event time, Flight Software Version number) in a      ",
  0, "    fixed format (i.e. format is the same for all detail lines).     ",
  0, "      STIM.TAB is a fixed format version of this information that    ",
  0, "    may be imported into a spreadsheet.                              ",
  0, "      Version 2.4 and later flight software provides an indication   ",
  0, "    of when a valid external IEB load has occured.  We haven't       ",
  0, "    propogated this information through to the u files, so we can't  ",
  0, "    automatically take advantage of this information, we must hand   ",
  0, "    update the IEB table as required.  Inspection of the table will  ",
  0, "    reveal periods where we operate with the internal table for      ",
  0, "    short periods of time.                                           ",
  0, "                                                                     ",
  0, "      Currently there is no effort to break STIM files up into       ",
  0, "    convenient size files, everything for the intended archive       ",
  0, "    volume appears in a single file.  To accomodate an on-line       ",
  0, "    archive, the STIM files may contains a full years worth of data. ",
  0, "    The size of the file may become an issue and require some form   ",
  0, "    of accomodation.                                                 ",
  0, "                                                                     ",
  0, "      We can achieve some level of heirarchy by processing data      ",
  0, "    in 1 year, 100 day, or 1 day groups (-splitstim).                ",
  0, "                                                                     ",
  0, "  MAKE_HR_BROWSE.BAT                                                 ",
  0, "      This file contains a shell script that is used to produce      ",
  0, "    browse images as well as thumbnails of the browse images.        ",
  0, "    Actual start/stop time are used, so the image may not be         ",
  0, "    a full hour.                                                     ",
  0, "                                                                     ",
  0, "  HR_ARCHIVE_HELP.TXT                                                ",
  0, "      The extended help file for the archive program may be placed   ",
  0, "    in the EXTRAS directory.                                         ",
  0, "                                                                     ",
  0, "  MEDIA_LABEL_HR_1.PS                                                ",
  0, "      This file contains the postscript used to produce the          ",
  0, "    adhesive label on the CD/DVD.  Identical labels can be made      ",
  0, "    in the future using this file.  It identifies data start and     ",
  0, "    stop time, the date that the archive was built on, and the       ",
  0, "    version string from the archive program.  This is fitted to      ",
  0, "    make use of a specific style of label and on a specific printer  ",
  0, "    as indicated (specifics are listed on the label, off of the      ",
  0, "    area that is affixed to the CD/DVD).                             ",
  0, "                                                                     ",
  0, "  Top Group                                                          ",
  0, "      Simply the title block, indicating the CD/DVD comes from       ",
  0, "    RPWS at the University of Iowa.                                  ",
  0, "                                                                     ",
  0, "  Left Group                                                         ",
  0, "      Start/Stop times for WBRFULL dataset.  Scheduling within the   ",
  0, "    instrument is quite flexible, so it is not unreasonable to have  ",
  0, "    periods where WBR data has not been generated.                   ",
  0, "                                                                     ",
  0, "  Right Group                                                        ",
  0, "      Start/Stop time for WFRFULL dataset.  In most modes we would   ",
  0, "    expect to see WFR data.  Keep in mind, however, that the         ",
  0, "    instrument may be configured to not produce WFR data.            ",
  0, "                                                                     ",
  0, "      Both WFRFULL and WBRFULL time include both SCET and SCLK       ",
  0, "    times.  Also, SCLK is provided in bot a decimal and a hexadecimal",
  0, "    format as a convenience to the user.                             ",
  0, "      The decimal form of SCLK matches the format used by the        ",
  0, "    SPICE kernel.  The fractional part of time is 1/256 of a         ",
  0, "    second (this corresponds to the fine timing field which is       ",
  0, "    8 bits long).                                                    ",
  0, "      The hexadecimal SCLK is similar to that seen when viewing      ",
  0, "    GSE displays.  The fractional portion of the SCLK represents     ",
  0, "    RTI (keeping in mind this is the basic timing resolution of      ",
  0, "    the instrument).  This fractional portion ranges from 0 through  ",
  0, "    7 (8 RTI periods per second).                                    ",
  0, "                                                                     ",
  0, "  Bottom Group                                                       ",
  0, "    Selected Start/Stop times                                        ",
  0, "      This text, located in the bottom group of test fields, is      ",
  0, "    immediately above the start and stop time that was specified     ",
  0, "    when the CD/DVD was initially produced.  The start time is       ",
  0, "    obtained from the stop time of the previous run (usually         ",
  0, "    regressed to the start of a day, for convenience).  The stop     ",
  0, "    time, however, depends on the size of the media and the          ",
  0, "    space required for quick-look data.  The stop time is,           ",
  0, "    therefore, usually specified as the end of the year and the      ",
  0, "    archive program then stops creating files when a specified       ",
  0, "    limit is reached (i.e., when the media is close to full).        ",
  0, "                                                                     ",
  0, "    Data size approx. xxxMB(end/mid)                                 ",
  0, "      This is an indication of the volume requirement of the         ",
  0, "    WBRFULL/WFRFULL data on the volume.  The '(mid)' / '(end)'       ",
  0, "    key indicates when the end of the selected interval has been     ",
  0, "    reached (i.e. mid indicates we are mid-way in the file while     ",
  0, "    end indicates we have reached the send of the requested          ",
  0, "    interval).  This is provided as an aid where data was not        ",
  0, "    collected at the end of a specified interval (times prior to     ",
  0, "    year 2000 do not have data at the end of the calendar year).     ",
  0, "                                                                     ",
  0, "",
  0, "SPICE and Time: SCLK, SCET, and friends.                             ",
  0, "      We nomrmally make use of a spice kernel to calculate SCET.     ",
  0, "    SCLK is the known time reference, it is manipulated within the   ",
  0, "    instrument and within the spacecraft.  SCET is a derived value   ",
  0, "    that is provided with the instrument data and recalculated       ",
  0, "    (using the SPICE kernels) when we produce an archive dataset.    ",
  0, "    We attempt to make use of the current best estimate of SCET      ",
  0, "    when producing the archive dataset.                              ",
  0, "                                                                     ",
  1, "      SCET is provided in the archive data in a format that is used  ",
  1, "    in the data that we collect from the database servers at JPL.    ",
  1, "    It is expressed as days since and epoch and milliseconds of day. ",
  2, "      SCET is provided in the archive data in a format that is used  ",
  2, "    in the SPICE KERNEL.  This is a double precision number (MSB).   ",
  2, "    It is called Barycentric Dynamical Time (TDB) and it has an      ",
  2, "    epoch of Noon, Jan 1st. 2000.                                    ",
  3, "      SCET is provided in the archive data as an ASCII text string.  ",
  4, "      SCET is provided in the archive in 2 forms, TDB (Barycentric   ",
  4, "    Dynamical Time) as well as the format supplied wit the raw       ",
  4, "    data in CHDO headers).  TDB is a double precision floating point ",
  4, "    number (MSB), while the format delivered in the CHDO headers     ",
  4, "    consists of days from epoch and milliseconds of day).            ",
  0, "                                                                     ",
  0, "      SCLK is provided in the same format as supplied in header      ",
  0, "    records prepended to data we receive from JPL.  It consists of   ",
  0, "    a 32 bit seconds counter, that matches the 32 SCLK used on the   ",
  0, "    spacecraft, and a 16 bit counter that contains 8 bits of         ",
  0, "    sub-second timing.  This 16 field will have a value between      ",
  0, "    0 and 255, all other values being invalid.                       ",
  0, "                                                                     ",
  0, "  A note about SCLK, as handled by RPWS                              ",
  0, "        (Refer to the RPWS User Guide / Software Operations Manual)  ",
  0, "      RPWS keeps track of time to an accuracy of 1 RTI (125          ",
  0, "    milliseconds).  The spacecraft clock, being 40 bits, can         ",
  0, "    represent time to an accuracy of about 4 milliseconds (1/256th   ",
  0, "    of a second).  RPWS, however, uses the lower 5 bits of the       ",
  0, "    40 bit clock for it's own (devious) purposes.  This is           ",
  0, "    particularly evident in HRS (i.e. WBR) data.  When we produce    ",
  0, "    the archive data, we mask off the lower 5 bits of the 40 bit     ",
  0, "    clock prior to calling the SPICE kernels in order to obtain      ",
  0, "    an accurate clock.  All starting times will have their lower     ",
  0, "    5 bits clear (as WBR and WFR always start relative to the        ",
  0, "    RTI signal, with 1 exception for the WBR).  Stop times, however  ",
  0, "    are calculated using a start time, sample count, and sample      ",
  0, "    rate.  The stop time represents the time of the last sample      ",
  0, "    in the dataset (and may run into the next day, in some cases).   ",
  0, "      WBR can operate in a mode where it is not synchronized to the  ",
  0, "    RTI signal.  In this case, there is an status field that gives   ",
  0, "    an indication of how far into the RTI data collection begins.    ",
  0, "    We still use the begining of the RTI period as the timetag for   ",
  0, "    the data.  The mode is nominally a high bit rate mode, and this  ",
  0, "    can result in more than 1 record having the same time tag.       ",
  0, "                                                                     ",
  0, "  Time formats in the archive data (SCET)                            ",
  1, "      The time format we have chosen to use in the archive datasets  ",
  1, "    is compact and easy to describe.  We eliminate ambiguity about   ",
  1, "    leap seconds by using days and milliseconds (there can be up to  ",
  1, "    86,401,999 milliseconds in a day).  This time format is also     ",
  1, "    not dependant on the SPICE kernel, it can be decoded easily      ",
  1, "    and quickly.                                                     ",
  2, "      The time format in the archive datasets is a double precision  ",
  2, "    floating point item, IEEE format, MSB first.  Epoch is Noon on 1 ",
  2, "    Jan 2000, with times prior to epoch being expressed as a negative",
  2, "    value.  This is the format used internally by SPICE.             ",
  3, "      The time format is a simple ASCII string.  Look at it, the     ",
  3, "    format is self-explanatory.                                      ",
  4, "      Both TDB and CHDO formats are included in the archive record.  ",
  4, "    TDB is a double precision floating point item, IEEE format, MSB  ",
  4, "    first.  Epoch is Noon on Jan 1 of 2000.  The CHDO time consists  ",
  4, "    of a 16 bit day and a 32 bit millisecond of day.                 ",
  0, "",
  0, "Procedures                                                           ",
  0, "      The program collects data from the decompressed instrument     ",
  0, "    minipacket files that reside on the analysis systems at Iowa.    ",
  0, "    At Iowa, we refer to them as 'U' files (U for uncompressesed     ",
  0, "    minipackets).  All that is required by the archive program are   ",
  0, "    the desired start time and the desired stop time.  The program   ",
  0, "    will gather data from the 'U' files, reformat into the archive   ",
  0, "    format, and produce the 1 hour WBR and 24 hour WFR data files.   ",
  0, "    When enough data has been reformatted to fill a CD or DVD, the   ",
  0, "    file output activities will terminate and label files will be    ",
  0, "    written (the label files are not written untill the end as they  ",
  0, "    contain record counts that are updated continuously).            ",
  0, "                                                                     ",
  0, "      Also, as part of the label file processing, the TIME_FILE      ",
  0, "    and the MEDIA_LABEL files are produced.  As these contain        ",
  0, "    start and stop time, they cannot be produced until all of the    ",
  0, "    data files have been created.                                    ",
  0, "                                                                     ",
  0, "      Yet another byproduct of label file processing are the HTML    ",
  0, "    files and a shell script.  These are used to produce the         ",
  0, "    browse dataset.  This is accomplished by using an external       ",
  0, "    shell script that is called by the shell script produced here.   ",
  0, "    The shell script produced here has prototype filenames along with",
  0, "    start/stop times.  The HTML file assumes that a set of PNG's     ",
  0, "    for full resolution images as well as thumbnails will eventually ",
  0, "    end up in the BROWSE directory and references the images         ",
  0, "    accordingly.                                                     ",
  0, "                                                                     ",
  0, "      And, not to forget, there is also a pair of label files for the",
  0, "    PNG files.  They are rather static in nature, but they do contain",
  0, "    a list of the expected PNG files.  Note that there is an         ",
  0, "    underlying assumption that the existing data set (from which the ",
  0, "    archive is being produced) is clean and that the minipackets that",
  0, "    appear are valid and reasonable.  When bad data is encountered,  ",
  0, "    inappropriate WBR/WFR files may be produced for which we cannot  ",
  0, "    (and probably should not) produce browse images.  The end result ",
  0, "    being that the label file may point to files that do not exist). ",
  0, "                                                                     ",
  0, "      The STIM file is written as STIM records are encountered.      ",
  0, "    At the end, a few lines of comments are written to the file      ",
  0, "    to make it easy to determine if the entire file has been         ",
  0, "    correctly produced.                                              ",
  0, "                                                                     ",
  0, "      Command line switches may be used to alter much of the default ",
  0, "    behavior.                                                        ",
  0, "                                                                     ",
  0, "  Fitting data on a CD or DVD                                        ",
  0, "      To eliminate the need to move files about, the archive program ",
  0, "    accumulates the bytes written to each data file and stops writing",
  0, "    data when a predetermined volume of data (-size command line     ",
  0, "    switch) has been written to the output directory.  This does NOT ",
  0, "    include the size of the label files of the files that are save in",
  0, "    the EXTRAS directory.  In addition, sufficient space must be     ",
  0, "    reserved for the quick-look dataset that will be produced        ",
  0, "    following the archive activity.                                  ",
  0, "      The default value may be obtained from the help page and should",
  0, "    be set to reflect a size appropriate to the media that is being  ",
  0, "    used at the time.                                                ",
  0, "                                                                     ",
  0, "  Sample use                                                         ",
  0, "      The following sample script was used during testing to         ",
  0, "    produce sample CD's.  This creates a the directory structure     ",
  0, "    and then populates the WBRFULL, WFRFULL, and EXTRAS directories. ",
  0, "                                                                     ",
  0, "          #!/bin/sh                                                  ",
  0, "          mkdir cdrom$1                                              ",
  0, "          mkdir cdrom$1/INDEX                                        ",
  0, "          mkdir cdrom$1/DOCUMENT                                     ",
  0, "          mkdir cdrom$1/CATALOG                                      ",
  0, "          mkdir cdrom$1/BROWSE                                       ",
  0, "          mkdir cdrom$1/BROWSE/LRB                                   ",
  0, "          mkdir cdrom$1/BROWSE/WBRB                                  ",
  0, "          mkdir cdrom$1/BROWSE/WFRB                                  ",
  0, "          mkdir cdrom$1/DATA                                         ",
  0, "          mkdir cdrom$1/DATA/KEY                                     ",
  0, "          mkdir cdrom$1/DATA/LRFULL                                  ",
  0, "          mkdir cdrom$1/DATA/WBRFULL                                 ",
  0, "          mkdir cdrom$1/DATA/WFRFULL                                 ",
  0, "          mkdir cdrom$1/DATA/ANCIL                                   ",
  0, "          mkdir cdrom$1/EXTRAS                                       ",
  0, "          cd cdrom$1                                                 ",
  0, "          rpws_archive                                               ",
  0, "                  -database                                          ",
  0, "                  -spice                                             ",
  0, "                  +ephem                                             ",
  0, "                  -pad                                               ",
  0, "                  -zero                                              ",
  0, "                  -target \"Solar System\"                             ",
  0, "                  -cd_format \"ISO9660\"                               ",
  0, "                  -cd_index $1                                       ",
  0, "                  -dbase_st $2                                       ",
  0, "                  -dbase_sp $3                                       ",
  0, "          cd ..                                                      ",
  0, "                                                                     ",
  0, "      Obviously, the first set of commands create the directory      ",
  0, "    structure that appears on the CD/DVD.  The first argument to the ",
  0, "    script is a volume number, it will appear at the top of the CD.  ",
  0, "    We also use this to create a subdirectory for the CD/DVD image.  ",
  0, "    The only other arguments to the script are the start and stop    ",
  0, "    times.  In the case of the test runs, I simply specified the     ",
  0, "    stop time as the end of the year and allows the archive          ",
  0, "    \"rpws_archive\" to run until it filled up the CD (600MB).         ",
  0, "    Subsequent runs were started at the begining of the last day     ",
  0, "    of the previous run, giving some overlap, but always starting    ",
  0, "    at the begining of the day.                                      ",
  0, "                                                                     ",
  0, "      The command line arguments have the following meanings:        ",
  0, "                                                                     ",
  0, "      -database                                                      ",
  0, "      -dbase_st <start-time>                                         ",
  0, "      -dbase_sp <stop-time>                                          ",
  0, "            This set of switches tells \"rpws_archive\" to use the     ",
  0, "          database file to collect the archive data from the on-line ",
  0, "          system at Iowa.  This allows us to simply give desired     ",
  0, "          start and stop times without having to worry about where   ",
  0, "          the data is located.  This collects data from the same     ",
  0, "          files used by the various web pages at Iowa.               ",
  0, "                                                                     ",
  0, "      -spice                                                         ",
  0, "            Make use of the spice kernel to calculate times.         ",
  0, "          (rather than using the sclk/scet pair in the chdo record). ",
  0, "          We should be using the '-spice' flag (leaves the mini-     ",
  0, "          packet data unaltered).                                    ",
  0, "                                                                     ",
  0, "      -spfix                                                         ",
  0, "            This switch explicitly tells \"rpws_archive\" to use     ",
  0, "          the SPICE kernel to calculate the value of SCLK saved in   ",
  0, "          the archive data.  Although there is time supplied in the  ",
  0, "          on-line data, we can choose to recalculate to obtain the   ",
  0, "          current best estimate of time known at the time the archive",
  0, "          dataset is produced.                                       ",
  0, "            3/31/2005 Note:                                          ",
  0, "          Doesn't seem to get the day right!!!  chdo->scet is stored ",
  0, "          as 16b-day + 32b-uSec and you have to do the day           ",
  0, "          correctly (and it currently doesn't).                      ",
  0, "                                                                     ",
  0, "      +ephem                                                         ",
  0, "            Add detail lines to the label files that contain a       ",
  0, "          representation of TDB (Barycentric Dynamical Time).        ",
  0, "          This is a floating point number that is the number of      ",
  0, "          seconds since the J200 epoch (this starts at 12:00).       ",
  0, "          Since we launched prior to thes point in time, early data  ",
  0, "          will have a negative value in this field.                  ",
  0, "                                                                     ",
  0, "      -zero                                                          ",
  0, "            Make start/stop times in the label files aligned on      ",
  0, "          hour or day boundary (as appropriate).                     ",
  0, "                                                                     ",
  0, "      -pad                                                           ",
  0, "            Label records are NOT padded to 80 bytes.  Each line     ",
  0, "          has the line termination character(s) immediately following",
  0, "          the last non-blank character on the line.  If necessary    ",
  0, "          you can pad the label files to 80 characters using \"+pad\". ",
  0, "                                                                     ",
  0, "      -target <body-name>                                            ",
  0, "            This provides access to the \"TARGET_NAME\" field in the   ",
  0, "          label record.                                              ",
  0, "      -phase <phase name>                                            ",
  0, "            Although not used above, this is similar to \"-target\" and",
  0, "          gives us access to the \"MISSION_PHASE_NAME\" field in the   ",
  0, "          label record.  (Internal table used if this is blank)      ",
  0, "                                                                     ",
  0, "      -cd_format <format>                                            ",
  0, "            This provides access to a field in the CD/DVD label file.",
  0, "          It is intended to be used to indicate the type of file     ",
  0, "          system that is on the CD/DVD.  This field is simply a      ",
  0, "          string the should contain something like \"ISO9660\" or      ",
  0, "          \"ISO9660/UDF\".                                             ",
  0, "                                                                     ",
  0, "      -cd_index <number>                                             ",
  0, "            This is a string (usually a number) that contains the    ",
  0, "          member number (i.e. which CD in the set this is).  This    ",
  0, "          string is combined with some text and placed at the top    ",
  0, "          edge of the CD/DVD label (there isn't much room, so it     ",
  0, "          should be a number, not text).                             ",
  0, "                                                                     ",
  0, "",
  0, "Mastering CD/DVD media                                               ",
  0, "    The archive program simply populates a set of directories with   ",
  0, "  files reformatted from the level-1 archive.  It does not           ",
  0, "  provide CD/DVD mastering.  This step is provided by 'mkisofs'      ",
  0, "  and 'cdrecord'/'dvdrecord'.  The mkisofs program needs to be       ",
  0, "  properly configured to produce an ISO9660/UDF image that can       ",
  0, "  be written to a CD/DVD.                                            ",
  0, "                                                                     ",
  0, "    The archive media is the produced using cdrecord or dvdrecord    ",
  0, "  from the ISO/UDF image produced by mkisofs.                        ",
  0, "                                                                     ",
  0, "    Please note, from the section above, that the ISO9660 and/or     ",
  0, "  UDF text that is placed on the CD/DVD label is provided, as a      ",
  0, "  command line argument, to 'rpws_archive'.  It should be specified  ",
  0, "  as appropriate when producing CD's or DVD's (i.e. we would want    ",
  0, "  CD to be produced to ISO9660 standards and DVD to be produced      ",
  0, "  to both ISO9660 and UDF standards).                                ",
  0, "                                                                     ",
  0, "",
  0, "Version Information                                                  ",
  0, "    Version changes for the archiving software:                      ",
  0, "                                                                     ",
  0, "  rpws_label V4.5  rpws_fsw V2.2                                     ",
  0, "      Changed label keyword to ORBIT_NAME                            ",
  0, "  rpws_browse & rpws_master_browse V3.5                              ",
  0, "      ALT= previously had 'would not render'...  changed that to     ",
  0, "        'Spectrogram'.  Images are always there, although some       ",
  0, "        may indicate questionable data for the period.               ",
  0, "  rpws_browse V3.3                                                   ",
  0, "      Make browse and thumbnail image production look for            ",
  0, "      existing files (had problems and need to rerun the browse      ",
  0, "      image creation step again, but don't want to reproduce         ",
  0, "      existing images).                                              ",
  0, "  rpws_label V4.5                                                    ",
  0, "      ORBIT_NUMBER                                                   ",
  0, "  V8.1                                                               ",
  0, "      +mafi (flag to insert addition fields into PNG labels)         ",
  0, "  V8.0                                                               ",
  0, "      Doooh.  Lost LFDR and MFR data (command line switch)           ",
  0, "  V7.5                                                               ",
  0, "      Changed time of COR table entry for antenna deploy             ",
  0, "      such that the data is referenced to Earth coordinates          ",
  0, "  V7.4a                                                              ",
  0, "      Prior to Saturn, no ORBIT_NUMBER in label.  (i.e.              ",
  0, "      comments are suppressed when we don't have orbit               ",
  0, "      numbers to show).                                              ",
  0, "  V7.4                                                               ",
  0, "      Orbit number in browse image script invocation                 ",
  0, "      Fix rpws_fsw_ver to do orbits correctly                        ",
  0, "  V7.3                                                               ",
  0, "      Orbit number lookup                                            ",
  0, "  V7.0/V7.1                                                          ",
  0, "      2/2005 Update                                                  ",
  0, "  V6.5                                                               ",
  0, "      Update to rpws_fsw_ver.c through S08 and 2006                  ",
  0, "  V6.4                                                               ",
  0, "      Running into occasional bad records that really hose the time  ",
  0, "        routines.  Added a check to eliminate record with clock      ",
  0, "        value greated than CASSINI_MAXIMUM_CLOCK                     ",
  0, "  V6.2                                                               ",
  0, "      Yet more changes in the directory structure.                   ",
  0, "        The STIM.TAB files in the DATA/ANCILLARY directory have been ",
  0, "      moved dow a level such that they are in a YEAR-100DAY          ",
  0, "      subdirectory.  New flag to cause this behavior.                ",
  0, "  V5.6                                                               ",
  0, "      STIM labels are a pain.  ONly handles 1 STIM file...           ",
  0, "  V5.5b                                                              ",
  0, "      Eliminate STIM.TXT and STIM.TAB when breaking it up by day     ",
  0, "  V5.5                                                               ",
  0, "      Added STIM 100-day and 1-year                                  ",
  0, "  V5.4                                                               ",
  0, "      Fix some problems in the label files (the leading DESCRIPTION  ",
  0, "      had some problems in STIM.LBL).                                ",
  0, "  V5.3a                                                              ",
  0, "      Fix time of V2.3.0 FSW update.                                 ",
  0, "  V5.3                                                               ",
  0, "      More label file updates.                                       ",
  0, "  V5.2/V5.2a                                                         ",
  0, "      2nd round of peer reviwe updates                               ",
  0, "    DESCRIPTION= line added to begining of label.  This entry is     ",
  0, "    extracted from the label by some of the PDS web display routines.",
  0, "      INFO.TXT created & destroyed, such that it is left in any      ",
  0, "    data directoy that is empty (says this directoy enmpty).         ",
  0, "      Variouos rpws-fsw-ver updates.                                 ",
  0, "  V5.1a                                                              ",
  0, "    Made SCLK in labels use colon for sec:msec delimiter             ",
  0, "  V5.                                                                ",
  0, "                                                                     ",
  0, "  V4.43                                                              ",
  0, "    In answer to the V4.43 question: 'Will it never end?!?'          ",
  0, "    NO, No Way, Never.  Added -zero flag to allow start/stop         ",
  0, "    times to be aligned on hour or day boundaries.                   ",
  0, "  rpws_label-V2.3                                                    ",
  0, "    Arrgh... Change COMMENT_TEXT back to NOTE (maybe I should        ",
  0, "    do a random selection here.  Then when someone wants something   ",
  0, "    different, we'll just look in a different label file...          ",
  0, "  V4.43                                                              ",
  0, "    Will it never end?!?  Update version field in label file to V1.0 ",
  0, "    Also, this uses an update MDB library...                         ",
  0, "  V4.42                                                              ",
  0, "    OOPS... Missed the DURATION field in STIM.TAB for XSTM records.  ",
  0, "  V4.41                                                              ",
  0, "    OOPS... DATA_SET_ID ended up with a duplicate version number.    ",
  0, "    remove offending text from label...                              ",
  0, "  V4.40                                                              ",
  0, "    Turn debugging output off                                        ",
  0, "  V4.39                                                              ",
  0, "    Egads, what a tortuous route to get counts to come out right.    ",
  0, "    record_count in the label matches file size now (still not       ",
  0, "    real sure we're no missing data, however).                       ",
  0, "    STIM.LBL FILE_RECORDS=nn needs to count the header!!! (add 1)    ",
  0, "    Also, we put sanity check information in the label file...       ",
  0, "  V4.34                                                              ",
  0, "    Zero-ing in on the problem.  Seems we have some files that       ",
  0, "    don't get re-opened... Hmmm.                                     ",
  0, "  V4.33                                                              ",
  0, "    Limit the number of concurrent open files (to around 20).        ",
  0, "  V4.30                                                              ",
  0, "    I think we've got it (i.e. length coming out right)              ",
  0, "    Also updated rpws_archive_example.c to perform some sanity       ",
  0, "    checks to aid in our debugging.  We'll leave them visible to     ",
  0, "    the world, what the heck...                                      ",
  0, "  V4.2x                                                              ",
  0, "    Trying to get that darn length just right                        ",
  0, "  V4.18                                                              ",
  0, "    Work-around for WBR?WFR data files not being same size as        ",
  0, "      indicated in the label.  If we extract WBR/WFR data from some  ",
  0, "      other packet, the length may be hosed (MSF bit).  Validity     ",
  0, "      check consists of looking for zero bits in the WFR data and    ",
  0, "      1 bits in the WBR data.  If this isn't correct, we strip the   ",
  0, "      lower 3 bits of archive->samples.  This eliminates the effect  ",
  0, "      of the MSF bit and we get an appropriate length.  The data is, ",
  0, "      however, flagged as suspect data.                              ",
  0, "  V4.17                                                              ",
  0, "    MISSION_PHASE_NAME and TARGET_NAME make use of the new routine   ",
  0, "      that uses start/stop to collect all applicable names.          ",
  0, "    RPWS_FSW routine now has MPN and TGT times as accurate as we     ",
  0, "      know them.  New routines make the appropriate set of names     ",
  0, "      (eliminated duplicate name strings).                           ",
  0, "  V4.14                                                              ",
  0, "    MISSION_PHASE_NAME and TARGET_NAME are broken into single        ",
  0, "    item per line to keep within 78 char line length limit.          ",
  0, "  V4.13a                                                             ",
  0, "    TARGET_NAME moved to table, similar to MISSION_PHASE_NAME.       ",
  0, "    (This table probably should be built assuming DAY boundaries).   ",
  0, "  V4.13                                                              ",
  0, "    TARGET_NAME and MISSION_PHASE keys are rebuilt into quoted       ",
  0, "    strings.  UnNderscore change to space.                           ",
  0, "    MISSION_PHASE_NAME changed                                       ",
  0, "    C39 IEB start time added                                         ",
  0, "  V4.12                                                              ",
  0, "    STIM.TAB delimiter -stim_delim                                   ",
  0, "  V4.11                                                              ",
  0, "    The FSW/IEB/MPN tables are rearranged, placing the version string",
  0, "    (mission phase name) at the end to accomodate external users of  ",
  0, "    the table.                                                       ",
  0, "  V4.10                                                              ",
  0, "    MISSION_PHASE_NAME Table added.  Additional fields in the -tname ",
  0, "    and -tdump fields to accomodate this.  No longer a default value ",
  0, "    for MISSION_PHASE_NAME (it will be taken from the internal table)",
  0, "    (This table probably should be built assuming DAY boundaries).   ",
  0, "  V4.9a                                                              ",
  0, "    Change MAKE_HR_BROWSE.BAT to make_he_browse.bat                  ",
  0, "  V4.9                                                               ",
  0, "    Add several detail lines to the EXTRAS/TIME_FILE.TXT to make     ",
  0, "    production of the dataset catalog a little easier.               ",
  0, "  V4.8                                                               ",
  0, "    Inlcude RAW telemetry in size count (-size nn flag).             ",
  0, "    Inlcude sub-directory in TIME_FILE.TXT.                          ",
  0, "  V4.7c                                                              ",
  0, "    Seems to be a good working version...                            ",
  0, "  V4.0                                                               ",
  0, "    Adds raw telemetry                                               ",
  0, "    Split RAW?WBR/WFR into 2 levels of subdirectory                  ",
  0, "  V3.7                                                               ",
  0, "    STIM.TAB/STIM.TXT sclk/scet fixed.                               ",
  0, "  V3.x                                                               ",
  0, "    Updates for 1st. public release of archive products.             ",
  0, "                                                                     ",
  0, "",
  0, "***** essay ********** essay ********** essay ********** essay ******",
  -1, NULL
};

int rpws_essay (FILE * file, int flag)
{
  int i = 0;

  while (text_item[i].flag >= 0) {
    if ((text_item[i].flag == 0) || (text_item[i].flag == flag))
      fprintf (file, "%s\n", text_item[i].text);
    i++;
  }
  return i;
}
